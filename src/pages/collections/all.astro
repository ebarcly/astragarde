---
import BaseLayout from "$/layouts/BaseLayout.astro";
import LimitedTime from "$/components/LimitedTime.astro";
import { setCache } from "$/utils/cache";
// import { getProducts } from "$/utils/shopify";
import Filters from "$/components/Filters.astro";
import SvelteFilter from "$/components/Filters.svelte";
import Sorter from "$/components/Sorter.astro";
import ProductsWrapper from "$/components/blocks/products/ProductsWrapper.svelte";

const title = "Catalog";
const headers = Astro.request.headers;
const ip = headers.get("x-vercel-forwarded-for") || Astro.clientAddress;

setCache.short(Astro);

// Mockup data for limited time collections
const limitedTime = [
  {
    title: "Shirt A",
    linkUrl: "/collections/shirt-a",
    img: "https://placehold.co/400x500?text=Shirt+A",
  },
  {
    title: "Shirt B",
    linkUrl: "/collections/shirt-b",
    img: "https://placehold.co/400x500?text=Shirt+B",
  },
];
---

<BaseLayout
  title={title}
  navigation={{ variant: "relative", enableScrollAnimation: true }}
>
  <LimitedTime products={limitedTime} />
  <div class="section-padding-x flex flex-col gap-8 lg:flex-row">
    <aside class="hidden w-80 max-w-xs lg:block lg:pr-8">
      <SvelteFilter client:only  />
    </aside>
    <main class="mx-auto w-full">
      <div class="mx-auto mt-6 flex w-full flex-row items-center gap-4 md:mt-0">
        <button
          class="flex flex-1 items-center justify-center gap-2 rounded-2xl bg-zinc-200 px-4 py-4 text-2xl font-normal text-black lg:hidden"
          onclick="document.getElementById('mobileFilter').classList.remove('hidden')"
        >
          Filter
          <!-- Filter icon SVG (use Heroicons or similar) -->
          <svg
            xmlns="http://www.w3.org/2000/svg"
            class="h-7 w-7"
            fill="none"
            viewBox="0 0 24 24"
            stroke="currentColor"
          >
            <path
              stroke-linecap="round"
              stroke-linejoin="round"
              stroke-width="2"
              d="M3 4a1 1 0 011-1h16a1 1 0 011 1v2a1 1 0 01-.293.707l-6.414 6.414A1 1 0 0013 13.414V19a1 1 0 01-1.447.894l-4-2A1 1 0 017 17v-3.586a1 1 0 00-.293-.707L3.293 6.707A1 1 0 013 6V4z"
            ></path>
          </svg>
        </button>
        <div class="flex-1">
          <Sorter />
        </div>
      </div>
      <ProductsWrapper client:load buyerIp={ip} />
    </main>
  </div>
  <div
    id="mobileFilter"
    class="fixed inset-0 z-50 hidden bg-black/40 transition-all duration-300 lg:hidden"
  >
    <div
      class="absolute top-0 left-0 h-full w-4/5 max-w-xs overflow-y-auto bg-white p-6 shadow-lg"
    >
      <button
        class="mb-4 font-bold text-zinc-900"
        onclick="document.getElementById('mobileFilter').classList.add('hidden')"
      >
        Close
      </button>
      <Filters />
    </div>
    <!-- Click outside to close -->
    <div
      class="absolute inset-0"
      onclick="document.getElementById('mobileFilter').classList.add('hidden')"
    >
    </div>
  </div>
</BaseLayout>
